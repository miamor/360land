var width=height=0;!function(n){function e(n){var e=n.changedTouches[0],i="";switch(n.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var t=document.createEvent("MouseEvent"),a=2;navigator.userAgent.match(/Android/i)&&(a=10),t.initMouseEvent(i,!0,!0,window,1,e.screenX,e.screenY,e.clientX*a,e.clientY*a,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}var i={repeat:!1,direction:"horizontal",animationTime:700,easing:"ease-out",overlay:!0};n.fn.panorama_viewer=function(t){return document.addEventListener("touchstart",e,!0),document.addEventListener("touchmove",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("touchcancel",e,!0),this.each(function(){var e=n.extend({},i,t),a=n(this);a.find("> img").load(function(){function i(i){var t={x:!1,y:!1},a={x:c.x-(d.x-i.clientX),y:c.y-(d.y-i.clientY)};return"horizontal"==e.direction?(1==e.repeat?t.x=!0:t.x=a.x<0&&-1*a.x<s.w,v&&t.x&&(c.x=a.x,c.y=0)):(1==e.repeat?t.y=!0:t.y=a.y<0&&-1*a.y<s.h,v&&t.y&&(c.y=a.y,c.x=0)),n(this).css("background-position",c.x+"px "+c.y+"px"),d.x=i.clientX,d.y=i.clientY,i.stopPropagation(),!1}a.find("> img").addClass("pv-pano"),width<a.find(".pv-pano").width()&&(width=a.find(".pv-pano").width()),height<a.find(".pv-pano").height()&&(height=a.find(".pv-pano").height()),a.addClass("pv-container").wrapInner("<div class='pv-inner pv-animating'></div>"),"vertical"==e.direction&&a.addClass("pv-vertical"),a.find(".pv-animating").css({"-webkit-transition":"all "+e.animationTime+"ms "+e.easing,"-moz-transition":"all "+e.animationTime+"ms "+e.easing,"-ms-transition":"all "+e.animationTime+"ms "+e.easing,transition:"all "+e.animationTime+"ms "+e.easing}),imgSrc=a.find(".pv-pano").attr("src");var t="no-repeat";1==e.repeat&&(t="repeat"),a.find(".pv-inner").css({height:height,width:width,background:"url("+imgSrc+") "+t,"background-size":"cover"}),1==e.overlay&&(n("<div class='pv-overlay'><i class='pvicon-overlay'></i></div>").appendTo(a.find(".pv-inner")),a.find(".pv-inner").bind("mouseenter",function(){n(this).find(".pv-overlay ").fadeOut("fast")}).bind("mouseleave",function(){n(this).find(".pv-overlay ").fadeIn("fast")}));var o=a.find(".pv-inner"),r={w:parseInt(o.parent().width()),h:parseInt(o.parent().height())},s={w:width-r.w,h:height-r.h},d={x:0,y:0},c={x:0,y:0},v=!1;o.bind("mousedown mouseup mouseleave",function(e){return v=!1,o.unbind("mousemove",i),"mousedown"==e.type?(d.x=e.clientX,d.y=e.clientY,v=!0,o.bind("mousemove",i)):n(document.body).focus(),e.stopPropagation(),!1}),o.bind("dblclick",function(){c={x:0,y:0},n(this).css("backgroundPosition","0 0")})})})}}(window.jQuery);
